<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Calculate R* convergence diagnostic — rstar • posterior</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Calculate R* convergence diagnostic — rstar" />
<meta property="og:description" content="The rstar() function generates a measure of convergence for MCMC draws
based on whether it is possible to determine the Markov chain that generated
a draw with probability greater than chance. To do so, it fits a machine
learning classifier to a training set of MCMC draws and evaluates its
predictive accuracy on a testing set: giving the ratio of accuracy to
predicting a chain uniformly at random." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">posterior</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Other Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="https://mc-stan.org/rstan">rstan</a>
    </li>
    <li>
      <a href="https://mc-stan.org/cmdstanr">cmdstanr</a>
    </li>
    <li>
      <a href="https://mc-stan.org/rstanarm">rstanarm</a>
    </li>
    <li>
      <a href="https://mc-stan.org/bayesplot">bayesplot</a>
    </li>
    <li>
      <a href="https://mc-stan.org/shinystan">shinystan</a>
    </li>
    <li>
      <a href="https://mc-stan.org/loo">loo</a>
    </li>
    <li>
      <a href="https://mc-stan.org/projpred">projpred</a>
    </li>
    <li>
      <a href="https://mc-stan.org/rstantools">rstantools</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://mc-stan.org">Stan</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://twitter.com/mcmc_stan">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/stan-dev/posterior">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://discourse.mc-stan.org/">
    <span class="fa fa-users"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Calculate R* convergence diagnostic</h1>
    <small class="dont-index">Source: <a href='https://github.com/stan-dev/posterior/blob/master/R/rstar.R'><code>R/rstar.R</code></a></small>
    <div class="hidden name"><code>rstar.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>The <code>rstar()</code> function generates a measure of convergence for MCMC draws
based on whether it is possible to determine the Markov chain that generated
a draw with probability greater than chance. To do so, it fits a machine
learning classifier to a training set of MCMC draws and evaluates its
predictive accuracy on a testing set: giving the ratio of accuracy to
predicting a chain uniformly at random.</p>
    </div>

    <pre class="usage"><span class='fu'>rstar</span>(
  <span class='no'>x</span>,
  <span class='kw'>split</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>uncertainty</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"rf"</span>,
  <span class='kw'>hyperparameters</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>training_proportion</span> <span class='kw'>=</span> <span class='fl'>0.7</span>,
  <span class='kw'>nsimulations</span> <span class='kw'>=</span> <span class='fl'>1000</span>,
  <span class='no'>...</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>A <code><a href='draws_df.html'>draws_df</a></code> object or one coercible to a <code>draws_df</code> object.</p></td>
    </tr>
    <tr>
      <th>split</th>
      <td><p>Logical. If <code>TRUE</code>, compute estimate on split chains.</p></td>
    </tr>
    <tr>
      <th>uncertainty</th>
      <td><p>Logical. Indicates whether to provide a vector of R*
values representing uncertainty in the calculated value (if <code>TRUE</code>) or a
single value (if <code>FALSE</code>). Default is <code>TRUE.</code></p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>The machine learning classifier to use (must be available in
the <span class="pkg">caret</span> package). The default is <code>"rf"</code>, which calls the random
forest classifier.</p></td>
    </tr>
    <tr>
      <th>hyperparameters</th>
      <td><p>A named list of hyperparameter settings passed to the
classifier. Default for random forest classifier (<code>method = "rf"</code>) is
<code>mtry = floor(sqt(nvariables(x)))</code>;
default for gradient-based model (<code>method = "gbm"</code>) is
<code>interaction.depth = 3, n.trees = 50, shrinkage = 0.1, n.minobsinnode = 10</code>.</p></td>
    </tr>
    <tr>
      <th>training_proportion</th>
      <td><p>Proportion of iterations used to train the
classifier. Default is 0.7.</p></td>
    </tr>
    <tr>
      <th>nsimulations</th>
      <td><p>Number of R* values in the returned vector if
<code>uncertainty</code> is <code>TRUE</code>. Default is 1000.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Other arguments passed to <code><a href='https://rdrr.io/pkg/caret/man/train.html'>caret::train()</a></code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A numeric vector of length 1 (by default) or length <code>nsimulations</code>
(if <code>uncertainty = TRUE</code>).</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The <code>rstar()</code> function provides a measure of MCMC convergence based
on whether it is possible to determine the chain that generated a
particular draw with a probability greater than chance. To do so, it fits a
machine learning classifier to a subset of the original MCMC draws (the
training set) and evaluates its predictive accuracy on the remaining draws
(the testing set). If predictive accuracy exceeds chance (i.e. predicting
the chain that generated a draw uniformly at random), the diagnostic
measure R* will be above 1, indicating that convergence has yet to occur.
This statistic is recently developed, and it is currently unclear what is a
reasonable threshold for diagnosing convergence.</p>
<p>The statistic, R*, is stochastic, meaning that each time the test is run,
unless the random seed is fixed, it will generally produce a different
result. To minimise the implications of this stochasticity, it is
recommended to repeatedly run this function to calculate a distribution of
R*; alternatively, an approximation to this distribution can be obtained by
setting <code>uncertainty = TRUE</code>, although this approximation of uncertainty
will generally have a lower mean.</p>
<p>By default, a random forest classifier is used (<code>method = "rf"</code>), which tends
to perform best for target distributions of around 4 dimensions and above.
For lower dimensional targets, gradient boosted models (called via
<code>method = "gbm"</code>) tend to have a higher classification accuracy. On a given
MCMC sample, it is recommended to try both of these classifiers.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Ben Lambert, Aki Vehtari (2020) R*: A robust MCMC convergence
diagnostic with uncertainty using gradient-boosted machines <em>arXiv
preprint</em> <code>arXiv:2003.07900</code>.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>caret</span>)</div><div class='output co'>#&gt; <span class='message'>Loading required package: lattice</span></div><div class='output co'>#&gt; <span class='message'>Loading required package: ggplot2</span></div><div class='input'><span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='example_draws.html'>example_draws</a></span>(<span class='st'>"eight_schools"</span>)
<span class='fu'>rstar</span>(<span class='no'>x</span>)</div><div class='output co'>#&gt; [1] 1.933333</div><div class='input'><span class='fu'>rstar</span>(<span class='no'>x</span>, <span class='kw'>split</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</div><div class='output co'>#&gt; [1] 1.466667</div><div class='input'><span class='fu'>rstar</span>(<span class='no'>x</span>, <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"gbm"</span>)</div><div class='output co'>#&gt; Iter   TrainDeviance   ValidDeviance   StepSize   Improve
#&gt;      1        2.0794             nan     0.1000    0.0212
#&gt;      2        2.0004             nan     0.1000    0.0027
#&gt;      3        1.9366             nan     0.1000   -0.0306
#&gt;      4        1.8827             nan     0.1000    0.0008
#&gt;      5        1.8242             nan     0.1000    0.0011
#&gt;      6        1.7644             nan     0.1000   -0.0338
#&gt;      7        1.7220             nan     0.1000   -0.0232
#&gt;      8        1.6712             nan     0.1000   -0.0482
#&gt;      9        1.6320             nan     0.1000   -0.0338
#&gt;     10        1.5853             nan     0.1000   -0.0010
#&gt;     20        1.2600             nan     0.1000   -0.0484
#&gt;     40        0.8695             nan     0.1000   -0.0414
#&gt;     50        0.7381             nan     0.1000   -0.0338
#&gt; </div><div class='output co'>#&gt; [1] 1.733333</div><div class='input'><span class='co'># can pass additional arguments to methods</span>
<span class='fu'>rstar</span>(<span class='no'>x</span>, <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"gbm"</span>, <span class='kw'>verbose</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</div><div class='output co'>#&gt; [1] 2.133333</div><div class='input'>
<span class='co'># with uncertainty, returns a vector of R* values</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/hist.html'>hist</a></span>(<span class='fu'>rstar</span>(<span class='no'>x</span>, <span class='kw'>uncertainty</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>))</div><div class='img'><img src='rstar-1.png' alt='' width='700' height='433' /></div><div class='input'><span class='fu'><a href='https://rdrr.io/r/graphics/hist.html'>hist</a></span>(<span class='fu'>rstar</span>(<span class='no'>x</span>, <span class='kw'>uncertainty</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>nsimulations</span> <span class='kw'>=</span> <span class='fl'>100</span>))</div><div class='img'><img src='rstar-2.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># can use other classification methods in caret library</span>
<span class='fu'>rstar</span>(<span class='no'>x</span>, <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"knn"</span>)</div><div class='output co'>#&gt; [1] 1.666667</div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Paul-Christian Bürkner, Jonah Gabry, Matthew Kay, Aki Vehtari.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


